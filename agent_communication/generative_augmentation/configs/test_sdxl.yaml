# SDXL 1.0 Base - 128x128 (multi-GPU training)
model:
  base_model: "stabilityai/stable-diffusion-xl-base-1.0"
  resolution: 128
  training_method: "lora"

lora:
  rank: 16
  alpha: 32
  dropout: 0.1
  target_modules: ["to_q", "to_k", "to_v", "to_out.0"]
  bias: "none"

data:
  data_root: "/workspace/DFUMultiClassification/data/DFU_Updated"
  modality: "rgb"
  phase: "I"
  train_val_split: 0.85
  split_seed: 42
  augmentation:
    enabled: true
    horizontal_flip: true
    vertical_flip: false
    rotation_degrees: 10
    color_jitter:
      brightness: 0.1
      contrast: 0.1
      saturation: 0.1
      hue: 0.05

training:
  batch_size_per_gpu: 2
  gradient_accumulation_steps: 1
  learning_rate: 1.0e-5
  lr_scheduler: "constant"
  lr_warmup_steps: 5
  lr_num_cycles: 1
  optimizer: "adamw"
  adam_beta1: 0.9
  adam_beta2: 0.999
  adam_weight_decay: 0.01
  adam_epsilon: 1.0e-8
  max_grad_norm: 1.0
  max_epochs: 20
  early_stopping:
    enabled: false
  max_train_samples: null  # Use all training images

prompts:
  enabled: true
  positive: >
    Medical photograph of diabetic foot ulcer in inflammatory phase,
    showing redness and swelling, early wound healing, acute inflammation,
    wound debridement phase, clinical documentation, high detail
  negative: >
    blurry, out of focus, low quality, jpeg artifacts,
    unrealistic colors, smooth skin, healthy tissue,
    artificial, cartoon, text, watermark

quality:
  perceptual_loss:
    enabled: true  # Re-enabled
    weight: 0.1
    vgg_layer: 16
  ema:
    enabled: true  # Re-enabled
    decay: 0.9999
    use_ema_weights_for_inference: true
  guidance_scale: 12.0
  inference_steps_training: 30
  inference_steps_production: 50

checkpointing:
  output_dir: "agent_communication/generative_augmentation/checkpoints/test_sdxl"
  save_every_n_epochs: 1
  keep_last_n_checkpoints: 2
  save_best_only: false
  resume_from_checkpoint: null
  save_optimizer_state: true

metrics:
  compute_every_n_epochs: 1
  num_samples_for_metrics: 50
  fid:
    enabled: true  # Re-enabled with debug logging to identify hang
    target_threshold: 50.0
  ssim:
    enabled: true
    target_threshold: 0.70
  lpips:
    enabled: true
    target_threshold: 0.30
    network: "alex"
  inception_score:
    enabled: true
    target_threshold: 2.0

logging:
  logging_dir: "agent_communication/generative_augmentation/reports/test_sdxl_logs"
  log_every_n_steps: 50
  save_samples_every_n_epochs: 1
  num_samples_to_save: 16
  use_tensorboard: true
  use_wandb: false

hardware:
  multi_gpu: true  # Enable multi-GPU training
  num_gpus: 2  # Use both RTX 4090s
  mixed_precision: "no"  # Disabled for testing - FP16 may cause NaN
  gradient_checkpointing: true
  use_xformers: false  # Disabled - SDXL attention dim (512) exceeds xformers limit (256)
  enable_cpu_offload: false
  num_workers: 8  # Increased for multi-GPU
  pin_memory: true

reproducibility:
  seed: 42
  deterministic: false

validation:
  validate_every_n_epochs: 1
  generate_samples: false  # Disabled for fast testing
  num_validation_samples: 4
  compare_to_real: true
  num_real_samples_for_comparison: 50
