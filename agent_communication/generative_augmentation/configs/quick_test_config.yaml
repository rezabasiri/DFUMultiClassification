# Quick Test Configuration for System Validation
# Tests training system with minimal resources (1-2 epochs, small data subset)

# ==============================================================================
# Model Configuration
# ==============================================================================
model:
  base_model: "stabilityai/stable-diffusion-2-1-base"
  resolution: 128
  training_method: "lora"

# ==============================================================================
# LoRA Configuration
# ==============================================================================
lora:
  rank: 16
  alpha: 32
  dropout: 0.1
  target_modules: ["to_q", "to_k", "to_v", "to_out.0"]
  bias: "none"

# ==============================================================================
# Data Configuration
# ==============================================================================
data:
  data_root: "data/DFU_Updated"
  modality: "rgb"
  phase: "I"  # Test with Phase I (has more images)
  train_val_split: 0.85
  split_seed: 42
  augmentation:
    enabled: true
    horizontal_flip: true
    vertical_flip: false
    rotation_degrees: 10
    color_jitter:
      brightness: 0.1
      contrast: 0.1
      saturation: 0.1
      hue: 0.05

# ==============================================================================
# Training Configuration (MINIMAL FOR TESTING)
# ==============================================================================
training:
  batch_size_per_gpu: 2  # Very small for quick testing
  gradient_accumulation_steps: 1
  learning_rate: 1.0e-5
  lr_scheduler: "constant"  # Simpler for testing
  lr_warmup_steps: 10
  lr_num_cycles: 1
  optimizer: "adamw"
  adam_beta1: 0.9
  adam_beta2: 0.999
  adam_weight_decay: 0.01
  adam_epsilon: 1.0e-8
  max_grad_norm: 1.0
  max_epochs: 2  # ONLY 2 EPOCHS FOR QUICK TEST
  early_stopping:
    enabled: false  # Disable for quick test

# ==============================================================================
# Prompting Configuration
# ==============================================================================
prompts:
  enabled: true
  positive: >
    Medical photograph of diabetic foot ulcer in inflammatory phase,
    showing redness and swelling, early wound healing, acute inflammation,
    wound debridement phase, clinical documentation, high detail
  negative: >
    blurry, out of focus, low quality, jpeg artifacts,
    unrealistic colors, smooth skin, healthy tissue,
    artificial, cartoon, text, watermark

# ==============================================================================
# Quality Enhancement
# ==============================================================================
quality:
  perceptual_loss:
    enabled: true
    weight: 0.1
    vgg_layer: 16
  ema:
    enabled: true
    decay: 0.9999
    use_ema_weights_for_inference: true
  guidance_scale: 12.0
  inference_steps_training: 20  # Fewer steps for testing
  inference_steps_production: 50  # Fewer steps for testing

# ==============================================================================
# Checkpointing
# ==============================================================================
checkpointing:
  output_dir: "agent_communication/generative_augmentation/checkpoints/quick_test"
  save_every_n_epochs: 1  # Save every epoch for testing
  keep_last_n_checkpoints: 2
  save_best_only: false
  resume_from_checkpoint: null
  save_optimizer_state: true

# ==============================================================================
# Quality Metrics
# ==============================================================================
metrics:
  compute_every_n_epochs: 1
  num_samples_for_metrics: 16  # Very few for testing
  fid:
    enabled: true
    target_threshold: 50.0
  ssim:
    enabled: true
    target_threshold: 0.70
  lpips:
    enabled: true
    target_threshold: 0.30
    network: "alex"
  inception_score:
    enabled: false  # Disable for speed

# ==============================================================================
# Logging & Monitoring
# ==============================================================================
logging:
  logging_dir: "agent_communication/generative_augmentation/reports/quick_test_logs"
  log_every_n_steps: 10
  save_samples_every_n_epochs: 1
  num_samples_to_save: 8
  use_tensorboard: false  # Disable for testing
  use_wandb: false

# ==============================================================================
# Hardware Configuration
# ==============================================================================
hardware:
  multi_gpu: false  # Use single GPU for testing
  num_gpus: 1
  mixed_precision: "fp16"
  gradient_checkpointing: true
  use_xformers: true
  enable_cpu_offload: false
  num_workers: 2  # Fewer workers for testing
  pin_memory: true

# ==============================================================================
# Reproducibility
# ==============================================================================
reproducibility:
  seed: 42
  deterministic: false

# ==============================================================================
# Validation
# ==============================================================================
validation:
  validate_every_n_epochs: 1
  generate_samples: true
  num_validation_samples: 4  # Very few for testing
  compare_to_real: true
  num_real_samples_for_comparison: 10  # Very few for testing
