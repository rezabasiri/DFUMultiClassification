2026-01-18 11:32:01,743 - INFO - ================================================================================
2026-01-18 11:32:01,743 - INFO - QUICK TEST MODE: 30.0% data, 2 epochs, 64x64 images
2026-01-18 11:32:01,743 - INFO - This is for error checking only - results not production-ready
2026-01-18 11:32:01,743 - INFO - ================================================================================

2026-01-18 11:32:01,743 - INFO - Saved original production_config values
2026-01-18 11:32:01,743 - INFO - Starting fresh test run
2026-01-18 11:32:01,744 - INFO - 
================================================================================
2026-01-18 11:32:01,744 - INFO - Starting test 1/2
2026-01-18 11:32:01,744 - INFO - ================================================================================
2026-01-18 11:32:01,744 - INFO - 
================================================================================
2026-01-18 11:32:01,744 - INFO - TEST: Baseline (no generative augmentation)
2026-01-18 11:32:01,744 - INFO - ================================================================================
2026-01-18 11:32:01,744 - INFO - Deleted cached dataset: depth_map_depth_rgb_metadata_thermal_map_15pct.csv
2026-01-18 11:32:01,745 - INFO - Deleted cached outliers: outliers_depth_map_depth_rgb_metadata_thermal_map_15pct.csv
2026-01-18 11:32:01,745 - INFO - Config updated: USE_GENERATIVE_AUGMENTATION=False
2026-01-18 11:32:01,745 - INFO - Modalities: metadata, depth_rgb, depth_map, thermal_map
2026-01-18 11:32:01,745 - INFO - Running: /venv/multimodal/bin/python src/main.py --data_percentage 30.0 --resume_mode fresh

COMMAND: /venv/multimodal/bin/python src/main.py --data_percentage 30.0 --resume_mode fresh

2026-01-18 11:32:02.299174: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2026-01-18 11:32:02.299230: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2026-01-18 11:32:02.300414: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2026-01-18 11:32:02.955194: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
/venv/multimodal/lib/python3.11/site-packages/transformers/utils/generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
/venv/multimodal/lib/python3.11/site-packages/transformers/utils/generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
/venv/multimodal/lib/python3.11/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA GeForce RTX 4090 - 24.0GB (compute 8.9)
  GPU 1: NVIDIA GeForce RTX 4090 - 24.0GB (compute 8.9)

Selected GPU 0: NVIDIA GeForce RTX 4090 (24.0GB)
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 64 (global batch size: 64, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 30.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 64x64
Batch size: 64
Max epochs: 2 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 2 files deleted
  Csv Results: 1 files deleted
  Tf Cache: 4 files deleted
================================================================================


Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_map_depth_rgb_metadata_thermal_map
Detecting outliers for combination: depth_map_depth_rgb_metadata_thermal_map (contamination=15%)...
  Total outliers: 417/2774 (15.0%)
  Cleaned dataset: 2357 samples
  Saved cleaned dataset: depth_map_depth_rgb_metadata_thermal_map_15pct.csv
Applying cleaned dataset for depth_map_depth_rgb_metadata_thermal_map (15% outlier removal)...
  Filtered: 2774 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_map_depth_rgb_metadata_thermal_map: 2357 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: metadata, depth_rgb, depth_map, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2774
  depth_bb: 2774
  depth_map: 2774
  thermal_map: 2774
  thermal_bb: 2774
  metadata: 2774
Using 30.0% of the data: 832 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/3: 117 train patients, 59 valid patients
  Train dist: {0: 0.231, 1: 0.657, 2: 0.113}
  Valid dist: {0: 0.307, 1: 0.606, 2: 0.087}
Fold 2/3: 117 train patients, 59 valid patients
  Train dist: {0: 0.281, 1: 0.627, 2: 0.092}
  Valid dist: {0: 0.216, 1: 0.662, 2: 0.123}
Fold 3/3: 118 train patients, 58 valid patients
  Train dist: {0: 0.256, 1: 0.637, 2: 0.107}
  Valid dist: {0: 0.252, 1: 0.650, 2: 0.098}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
Generative augmentation disabled

Preparing datasets for Fold 1/3 with all modalities: ['metadata', 'depth_rgb', 'thermal_map', 'depth_map']
Using consistent patient split across all modality combinations for run 1
Using Scikit-learn RandomForestClassifier

No existing data found for metadata+depth_rgb+depth_map+thermal_map, starting fresh

Training metadata+depth_rgb+depth_map+thermal_map with modalities: ['metadata', 'depth_rgb', 'depth_map', 'thermal_map'], fold 1/3
================================================================================
AUTOMATIC PRE-TRAINING: depth_rgb weights not found
  Training depth_rgb-only model first (same data split)...
================================================================================
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1768736167.691507 1391910 device_compiler.h:186] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
  Pre-training completed! Best val kappa: 0.0000
2026-01-18 11:36:57,895 - INFO -     Pre-training completed! Best val kappa: 0.0000
================================================================================
No existing pretrained weights found
