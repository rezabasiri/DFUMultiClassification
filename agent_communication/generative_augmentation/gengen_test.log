2026-01-18 21:28:48,776 - INFO - Saved original production_config values
2026-01-18 21:28:48,776 - INFO - Starting fresh test run
2026-01-18 21:28:48,777 - INFO - 
================================================================================
2026-01-18 21:28:48,777 - INFO - Starting test 1/2
2026-01-18 21:28:48,777 - INFO - ================================================================================
2026-01-18 21:28:48,777 - INFO - 
================================================================================
2026-01-18 21:28:48,777 - INFO - TEST: Baseline (no generative augmentation)
2026-01-18 21:28:48,777 - INFO - ================================================================================
2026-01-18 21:28:48,777 - INFO - Deleted cached dataset: depth_map_depth_rgb_metadata_thermal_map_15pct.csv
2026-01-18 21:28:48,778 - INFO - Deleted cached outliers: outliers_depth_map_depth_rgb_metadata_thermal_map_15pct.csv
2026-01-18 21:28:48,778 - INFO - Config updated: USE_GENERATIVE_AUGMENTATION=False
2026-01-18 21:28:48,778 - INFO - Modalities: metadata, depth_rgb, depth_map, thermal_map
2026-01-18 21:28:48,778 - INFO - Running: /venv/multimodal/bin/python src/main.py --data_percentage 100 --resume_mode fresh --device-mode multi

COMMAND: /venv/multimodal/bin/python src/main.py --data_percentage 100 --resume_mode fresh --device-mode multi

2026-01-18 21:28:49.404892: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2026-01-18 21:28:49.404947: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2026-01-18 21:28:49.406210: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered

================================================================================
DEVICE CONFIGURATION (mode: multi)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA GeForce RTX 4090 - 24.0GB (compute 8.9)
  GPU 1: NVIDIA GeForce RTX 4090 - 24.0GB (compute 8.9)

Selected 2 GPU(s):
  GPU 0: NVIDIA GeForce RTX 4090 (24.0GB)
  GPU 1: NVIDIA GeForce RTX 4090 (24.0GB)

Using MirroredStrategy (2 GPUs) with NCCL
  Compute capability 8.9 detected (native NCCL support)
  (Using NCCL for fastest multi-GPU communication)
  Effective batch size: 1Ã— global batch size
================================================================================


Batch size per replica: 64 (global batch size: 64, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 100.0%
Verbosity: 1 (NORMAL)
Device: GPUs [0, 1] (multi-GPU mode, MirroredStrategy)
  Replicas: 1Ã— batch size distribution
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 64x64
Batch size: 64
  Per-GPU batch: 64 (64 / 2 GPUs)
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Csv Results: 1 files deleted
  Tf Cache: 2 files deleted
================================================================================


Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_map_depth_rgb_metadata_thermal_map
Detecting outliers for combination: depth_map_depth_rgb_metadata_thermal_map (contamination=15%)...
  Total outliers: 417/2774 (15.0%)
  Cleaned dataset: 2357 samples
  Saved cleaned dataset: depth_map_depth_rgb_metadata_thermal_map_15pct.csv
Applying cleaned dataset for depth_map_depth_rgb_metadata_thermal_map (15% outlier removal)...
  Filtered: 2774 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_map_depth_rgb_metadata_thermal_map: 2357 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: metadata, depth_rgb, depth_map, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2774
  depth_bb: 2774
  depth_map: 2774
  thermal_map: 2774
  thermal_bb: 2774
  metadata: 2774
Using 100.0% of the data: 2774 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================

================================================================================
STRATIFIED K-FOLD SPLIT - CLASS DISTRIBUTION CHECK
================================================================================
Class 0: 72 patients
Class 1: 108 patients
Class 2: 28 patients
================================================================================

Fold 1/3: 138 train patients, 70 valid patients
  Train dist: {0: 0.292, 1: 0.596, 2: 0.113}
  Valid dist: {0: 0.264, 1: 0.646, 2: 0.089}
Fold 2/3: 139 train patients, 69 valid patients
  Train dist: {0: 0.272, 1: 0.638, 2: 0.091}
  Valid dist: {0: 0.303, 1: 0.565, 2: 0.132}
Fold 3/3: 139 train patients, 69 valid patients
  Train dist: {0: 0.284, 1: 0.606, 2: 0.110}
  Valid dist: {0: 0.280, 1: 0.628, 2: 0.092}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
Generative augmentation disabled

Preparing datasets for Fold 1/3 with all modalities: ['thermal_map', 'metadata', 'depth_map', 'depth_rgb']
Using consistent patient split across all modality combinations for run 1
Using Scikit-learn RandomForestClassifier

No existing data found for metadata+depth_rgb+depth_map+thermal_map, starting fresh

Training metadata+depth_rgb+depth_map+thermal_map with modalities: ['metadata', 'depth_rgb', 'depth_map', 'thermal_map'], fold 1/3
================================================================================
AUTOMATIC PRE-TRAINING: depth_rgb weights not found
  Training depth_rgb-only model first (same data split)...
================================================================================
Restoring model weights from the end of the best epoch: 32.
Epoch 62: early stopping
  Pre-training completed! Best val kappa: 0.0965
2026-01-18 21:49:34,488 - INFO -     Pre-training completed! Best val kappa: 0.0965
================================================================================
No existing pretrained weights found
Restoring model weights from the end of the best epoch: 1.
Epoch 11: early stopping
Restoring model weights from the end of the best epoch: 4.
Epoch 14: early stopping

Run 1 Results for metadata+depth_rgb+depth_map+thermal_map:
              precision    recall  f1-score   support

           I       0.37      0.26      0.31       252
           P       0.67      0.79      0.73       616
           R       0.50      0.28      0.36        85

    accuracy                           0.61       953
2026-01-18 22:08:44,230 - INFO -       accuracy                           0.61       953
   macro avg       0.51      0.45      0.47       953
weighted avg       0.58      0.61      0.58       953

Cohen's Kappa: 0.2202
2026-01-18 22:08:44,230 - INFO -   Cohen's Kappa: 0.2202

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.6076
2026-01-18 22:08:46,399 - INFO -   Accuracy: 0.6076
F1 Macro: 0.4653
Kappa: 0.2202
2026-01-18 22:08:46,399 - INFO -   Kappa: 0.2202

Fold 2/3
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier
Generative augmentation disabled

Preparing datasets for Fold 2/3 with all modalities: ['thermal_map', 'metadata', 'depth_map', 'depth_rgb']
Using consistent patient split across all modality combinations for run 2
Using Scikit-learn RandomForestClassifier

No existing data found for metadata+depth_rgb+depth_map+thermal_map, starting fresh

Training metadata+depth_rgb+depth_map+thermal_map with modalities: ['metadata', 'depth_rgb', 'depth_map', 'thermal_map'], fold 2/3
================================================================================
AUTOMATIC PRE-TRAINING: depth_rgb weights not found
  Training depth_rgb-only model first (same data split)...
================================================================================
Restoring model weights from the end of the best epoch: 84.
Epoch 114: early stopping
  Pre-training completed! Best val kappa: 0.1274
2026-01-18 22:42:56,223 - INFO -     Pre-training completed! Best val kappa: 0.1274
================================================================================
No existing pretrained weights found
Restoring model weights from the end of the best epoch: 6.
Epoch 16: early stopping
Restoring model weights from the end of the best epoch: 3.
Epoch 13: early stopping

Run 2 Results for metadata+depth_rgb+depth_map+thermal_map:
              precision    recall  f1-score   support

           I       0.45      0.52      0.48       285
           P       0.63      0.67      0.65       532
           R       0.69      0.29      0.41       124

    accuracy                           0.57       941
2026-01-18 23:04:36,668 - INFO -       accuracy                           0.57       941
   macro avg       0.59      0.49      0.51       941
weighted avg       0.58      0.57      0.57       941

Cohen's Kappa: 0.3420
2026-01-18 23:04:36,668 - INFO -   Cohen's Kappa: 0.3420

Training gating network for run 2...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 2:
Accuracy: 0.5717
2026-01-18 23:04:40,710 - INFO -   Accuracy: 0.5717
F1 Macro: 0.5132
Kappa: 0.3420
2026-01-18 23:04:40,710 - INFO -   Kappa: 0.3420

Fold 3/3
Using pre-computed fold 3 patient split
Using Scikit-learn RandomForestClassifier
Generative augmentation disabled

Preparing datasets for Fold 3/3 with all modalities: ['thermal_map', 'metadata', 'depth_map', 'depth_rgb']
Using consistent patient split across all modality combinations for run 3
Using Scikit-learn RandomForestClassifier

No existing data found for metadata+depth_rgb+depth_map+thermal_map, starting fresh

Training metadata+depth_rgb+depth_map+thermal_map with modalities: ['metadata', 'depth_rgb', 'depth_map', 'thermal_map'], fold 3/3
================================================================================
AUTOMATIC PRE-TRAINING: depth_rgb weights not found
  Training depth_rgb-only model first (same data split)...
================================================================================
Restoring model weights from the end of the best epoch: 70.
Epoch 100: early stopping
  Pre-training completed! Best val kappa: 0.1636
2026-01-18 23:36:05,446 - INFO -     Pre-training completed! Best val kappa: 0.1636
================================================================================
No existing pretrained weights found
Restoring model weights from the end of the best epoch: 21.
Epoch 31: early stopping
Restoring model weights from the end of the best epoch: 1.
Epoch 11: early stopping

Run 3 Results for metadata+depth_rgb+depth_map+thermal_map:
              precision    recall  f1-score   support

           I       0.41      0.52      0.45       246
           P       0.68      0.59      0.63       553
           R       0.33      0.35      0.34        81

    accuracy                           0.55       880
2026-01-19 00:06:08,934 - INFO -       accuracy                           0.55       880
   macro avg       0.47      0.48      0.47       880
weighted avg       0.57      0.55      0.55       880

Cohen's Kappa: 0.2978
2026-01-19 00:06:08,934 - INFO -   Cohen's Kappa: 0.2978

Training gating network for run 3...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 3:
Accuracy: 0.5466
2026-01-19 00:06:14,898 - INFO -   Accuracy: 0.5466
F1 Macro: 0.4734
Kappa: 0.2978
2026-01-19 00:06:14,898 - INFO -   Kappa: 0.2978
Results saved to /workspace/DFUMultiClassification/results/csv/modality_results_averaged.csv
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run1_train.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run1_valid.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run2_train.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run2_valid.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run3_train.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run3_valid.npy
Results for metadata, depth_rgb, depth_map, thermal_map appended to /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv

All results saved to /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv

================================================================================
FINAL SUMMARY - BEST MODALITY COMBINATIONS
================================================================================

Best by Accuracy:
2026-01-19 00:06:33,867 - INFO -   Best by Accuracy:
  Modalities: metadata+depth_rgb+depth_map+thermal_map
  Accuracy: 0.5753 Â± 0.0250
2026-01-19 00:06:33,867 - INFO -     Accuracy: 0.5753 Â± 0.0250
  F1 Macro: 0.4840
  Kappa: 0.2867
2026-01-19 00:06:33,867 - INFO -     Kappa: 0.2867

Total combinations tested: 1
================================================================================

2026-01-19 00:07:17,908 - INFO - Test completed in 158.5 minutes
2026-01-19 00:07:17,910 - INFO - âœ“ Test completed - Kappa: 0.2867
2026-01-19 00:07:17,910 - INFO - 
================================================================================
2026-01-19 00:07:17,910 - INFO - Starting test 2/2
2026-01-19 00:07:17,910 - INFO - ================================================================================
2026-01-19 00:07:17,910 - INFO - 
================================================================================
2026-01-19 00:07:17,910 - INFO - TEST: With generative augmentation (depth_rgb)
2026-01-19 00:07:17,911 - INFO - ================================================================================
2026-01-19 00:07:17,911 - INFO - Deleted cached dataset: depth_map_depth_rgb_metadata_thermal_map_15pct.csv
2026-01-19 00:07:17,911 - INFO - Deleted cached outliers: outliers_depth_map_depth_rgb_metadata_thermal_map_15pct.csv
2026-01-19 00:07:17,912 - INFO - Config updated: USE_GENERATIVE_AUGMENTATION=True
2026-01-19 00:07:17,913 - INFO - Modalities: metadata, depth_rgb, depth_map, thermal_map
2026-01-19 00:07:17,913 - INFO - Running: /venv/multimodal/bin/python src/main.py --data_percentage 100 --resume_mode fresh --device-mode multi

COMMAND: /venv/multimodal/bin/python src/main.py --data_percentage 100 --resume_mode fresh --device-mode multi

2026-01-19 00:07:18.517975: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2026-01-19 00:07:18.518037: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2026-01-19 00:07:18.519353: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered

================================================================================
DEVICE CONFIGURATION (mode: multi)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA GeForce RTX 4090 - 24.0GB (compute 8.9)
  GPU 1: NVIDIA GeForce RTX 4090 - 24.0GB (compute 8.9)

Selected 2 GPU(s):
  GPU 0: NVIDIA GeForce RTX 4090 (24.0GB)
  GPU 1: NVIDIA GeForce RTX 4090 (24.0GB)

Using MirroredStrategy (2 GPUs) with NCCL
  Compute capability 8.9 detected (native NCCL support)
  (Using NCCL for fastest multi-GPU communication)
  Effective batch size: 1Ã— global batch size
================================================================================


Batch size per replica: 64 (global batch size: 64, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 100.0%
Verbosity: 1 (NORMAL)
Device: GPUs [0, 1] (multi-GPU mode, MirroredStrategy)
  Replicas: 1Ã— batch size distribution
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 64x64
Batch size: 64
  Per-GPU batch: 64 (64 / 2 GPUs)
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 18 files deleted
  Predictions: 36 files deleted
  Csv Results: 15 files deleted
  Tf Cache: 4 files deleted
================================================================================


Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_map_depth_rgb_metadata_thermal_map
Detecting outliers for combination: depth_map_depth_rgb_metadata_thermal_map (contamination=15%)...
  Total outliers: 417/2774 (15.0%)
  Cleaned dataset: 2357 samples
  Saved cleaned dataset: depth_map_depth_rgb_metadata_thermal_map_15pct.csv
Applying cleaned dataset for depth_map_depth_rgb_metadata_thermal_map (15% outlier removal)...
  Filtered: 2774 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_map_depth_rgb_metadata_thermal_map: 2357 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: metadata, depth_rgb, depth_map, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2774
  depth_bb: 2774
  depth_map: 2774
  thermal_map: 2774
  thermal_bb: 2774
  metadata: 2774
Using 100.0% of the data: 2774 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================

================================================================================
STRATIFIED K-FOLD SPLIT - CLASS DISTRIBUTION CHECK
================================================================================
Class 0: 72 patients
Class 1: 108 patients
Class 2: 28 patients
================================================================================

Fold 1/3: 138 train patients, 70 valid patients
  Train dist: {0: 0.292, 1: 0.596, 2: 0.113}
  Valid dist: {0: 0.264, 1: 0.646, 2: 0.089}
Fold 2/3: 139 train patients, 69 valid patients
  Train dist: {0: 0.272, 1: 0.638, 2: 0.091}
  Valid dist: {0: 0.303, 1: 0.565, 2: 0.132}
Fold 3/3: 139 train patients, 69 valid patients
  Train dist: {0: 0.284, 1: 0.606, 2: 0.110}
  Valid dist: {0: 0.280, 1: 0.628, 2: 0.092}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
Initializing GenerativeAugmentationManager with models from results/GenerativeAug_Models/models_5_7

Preparing datasets for Fold 1/3 with all modalities: ['metadata', 'thermal_map', 'depth_rgb', 'depth_map']
Using consistent patient split across all modality combinations for run 1
Using Scikit-learn RandomForestClassifier

No existing data found for metadata+depth_rgb+depth_map+thermal_map, starting fresh

Training metadata+depth_rgb+depth_map+thermal_map with modalities: ['metadata', 'depth_rgb', 'depth_map', 'thermal_map'], fold 1/3
================================================================================
AUTOMATIC PRE-TRAINING: depth_rgb weights not found
  Training depth_rgb-only model first (same data split)...
================================================================================
Restoring model weights from the end of the best epoch: 60.
Epoch 90: early stopping
  Pre-training completed! Best val kappa: 0.0888
2026-01-19 00:38:15,372 - INFO -     Pre-training completed! Best val kappa: 0.0888
================================================================================
No existing pretrained weights found
Restoring model weights from the end of the best epoch: 1.
Epoch 11: early stopping
Restoring model weights from the end of the best epoch: 4.
Epoch 14: early stopping

Run 1 Results for metadata+depth_rgb+depth_map+thermal_map:
              precision    recall  f1-score   support

           I       0.36      0.25      0.29       252
           P       0.67      0.79      0.73       616
           R       0.50      0.28      0.36        85

    accuracy                           0.60       953
2026-01-19 00:58:47,686 - INFO -       accuracy                           0.60       953
   macro avg       0.51      0.44      0.46       953
weighted avg       0.57      0.60      0.58       953

Cohen's Kappa: 0.2133
2026-01-19 00:58:47,686 - INFO -   Cohen's Kappa: 0.2133

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.6034
2026-01-19 00:58:51,813 - INFO -   Accuracy: 0.6034
F1 Macro: 0.4593
Kappa: 0.2133
2026-01-19 00:58:51,813 - INFO -   Kappa: 0.2133

Fold 2/3
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier
Initializing GenerativeAugmentationManager with models from results/GenerativeAug_Models/models_5_7

Preparing datasets for Fold 2/3 with all modalities: ['metadata', 'thermal_map', 'depth_rgb', 'depth_map']
Using consistent patient split across all modality combinations for run 2
Using Scikit-learn RandomForestClassifier

No existing data found for metadata+depth_rgb+depth_map+thermal_map, starting fresh

Training metadata+depth_rgb+depth_map+thermal_map with modalities: ['metadata', 'depth_rgb', 'depth_map', 'thermal_map'], fold 2/3
================================================================================
AUTOMATIC PRE-TRAINING: depth_rgb weights not found
  Training depth_rgb-only model first (same data split)...
================================================================================
Restoring model weights from the end of the best epoch: 42.
Epoch 72: early stopping
  Pre-training completed! Best val kappa: 0.0922
2026-01-19 01:23:37,590 - INFO -     Pre-training completed! Best val kappa: 0.0922
================================================================================
No existing pretrained weights found
Restoring model weights from the end of the best epoch: 5.
Epoch 15: early stopping
Restoring model weights from the end of the best epoch: 9.
Epoch 19: early stopping

Run 2 Results for metadata+depth_rgb+depth_map+thermal_map:
              precision    recall  f1-score   support

           I       0.45      0.49      0.47       285
           P       0.63      0.66      0.64       532
           R       0.60      0.32      0.42       124

    accuracy                           0.57       941
2026-01-19 01:49:53,887 - INFO -       accuracy                           0.57       941
   macro avg       0.56      0.49      0.51       941
weighted avg       0.57      0.57      0.56       941

Cohen's Kappa: 0.3322
2026-01-19 01:49:53,888 - INFO -   Cohen's Kappa: 0.3322

Training gating network for run 2...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 2:
Accuracy: 0.5654
2026-01-19 01:50:01,781 - INFO -   Accuracy: 0.5654
F1 Macro: 0.5107
Kappa: 0.3322
2026-01-19 01:50:01,781 - INFO -   Kappa: 0.3322

Fold 3/3
Using pre-computed fold 3 patient split
Using Scikit-learn RandomForestClassifier
Initializing GenerativeAugmentationManager with models from results/GenerativeAug_Models/models_5_7

Preparing datasets for Fold 3/3 with all modalities: ['metadata', 'thermal_map', 'depth_rgb', 'depth_map']
Using consistent patient split across all modality combinations for run 3
Using Scikit-learn RandomForestClassifier

No existing data found for metadata+depth_rgb+depth_map+thermal_map, starting fresh

Training metadata+depth_rgb+depth_map+thermal_map with modalities: ['metadata', 'depth_rgb', 'depth_map', 'thermal_map'], fold 3/3
================================================================================
AUTOMATIC PRE-TRAINING: depth_rgb weights not found
  Training depth_rgb-only model first (same data split)...
================================================================================
Restoring model weights from the end of the best epoch: 80.
Epoch 110: early stopping
  Pre-training completed! Best val kappa: 0.1280
2026-01-19 02:26:09,956 - INFO -     Pre-training completed! Best val kappa: 0.1280
================================================================================
No existing pretrained weights found
Restoring model weights from the end of the best epoch: 20.
Epoch 30: early stopping
Restoring model weights from the end of the best epoch: 2.
Epoch 12: early stopping

Run 3 Results for metadata+depth_rgb+depth_map+thermal_map:
              precision    recall  f1-score   support

           I       0.35      0.49      0.41       246
           P       0.66      0.58      0.61       553
           R       0.41      0.27      0.33        81

    accuracy                           0.52       880
2026-01-19 02:57:02,652 - INFO -       accuracy                           0.52       880
   macro avg       0.47      0.45      0.45       880
weighted avg       0.55      0.52      0.53       880

Cohen's Kappa: 0.2252
2026-01-19 02:57:02,652 - INFO -   Cohen's Kappa: 0.2252

Training gating network for run 3...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 3:
Accuracy: 0.5239
2026-01-19 02:57:14,221 - INFO -   Accuracy: 0.5239
F1 Macro: 0.4498
Kappa: 0.2252
2026-01-19 02:57:14,221 - INFO -   Kappa: 0.2252
Results saved to /workspace/DFUMultiClassification/results/csv/modality_results_averaged.csv
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run1_train.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run1_valid.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run2_train.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run2_valid.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run3_train.npy
Saved metadata+depth_rgb+depth_map+thermal_map predictions to /workspace/DFUMultiClassification/results/checkpoints/combo_pred_metadata_depth_rgb_depth_map_thermal_map_run3_valid.npy
Results for metadata, depth_rgb, depth_map, thermal_map appended to /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv

All results saved to /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv

================================================================================
FINAL SUMMARY - BEST MODALITY COMBINATIONS
================================================================================

Best by Accuracy:
2026-01-19 02:57:32,644 - INFO -   Best by Accuracy:
  Modalities: metadata+depth_rgb+depth_map+thermal_map
  Accuracy: 0.5642 Â± 0.0325
2026-01-19 02:57:32,645 - INFO -     Accuracy: 0.5642 Â± 0.0325
  F1 Macro: 0.4733
  Kappa: 0.2569
2026-01-19 02:57:32,645 - INFO -     Kappa: 0.2569

Total combinations tested: 1
================================================================================

2026-01-19 02:58:15,502 - INFO - Test completed in 171.0 minutes
2026-01-19 02:58:15,503 - INFO - âœ“ Test completed - Kappa: 0.2569
2026-01-19 02:58:15,503 - INFO - 
================================================================================
2026-01-19 02:58:15,503 - INFO - ALL TESTS COMPLETE
2026-01-19 02:58:15,503 - INFO - ================================================================================
2026-01-19 02:58:15,503 - INFO - 
Generating final report...
2026-01-19 02:58:15,504 - INFO - Report saved to: /workspace/DFUMultiClassification/agent_communication/generative_augmentation/GENGEN_REPORT.txt
2026-01-19 02:58:15,506 - INFO - Restored original production_config values
2026-01-19 02:58:15,506 - INFO - 
Original configuration restored
