2026-01-07 17:59:49,825 - INFO - ================================================================================
2026-01-07 17:59:49,825 - INFO - AUTOMATED BACKBONE COMPARISON
2026-01-07 17:59:49,825 - INFO - ================================================================================
2026-01-07 17:59:49,825 - INFO - Log file: /home/rezab/projects/DFUMultiClassification/agent_communication/image_backbone/backbone_test.log
2026-01-07 17:59:49,825 - INFO - Starting FRESH run (previous results will be overwritten)
2026-01-07 17:59:49,825 - INFO - Saved original INCLUDED_COMBINATIONS
2026-01-07 17:59:49,826 - INFO - Configuration:
2026-01-07 17:59:49,826 - INFO -   RGB Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1', 'EfficientNetB3']
2026-01-07 17:59:49,826 - INFO -   MAP Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1']
2026-01-07 17:59:49,826 - INFO -   Data: 100%
2026-01-07 17:59:49,826 - INFO -   Image Size: 64x64
2026-01-07 17:59:49,826 - INFO -   Device: single
2026-01-07 17:59:49,826 - INFO -   Test modalities: depth_rgb + thermal_map
2026-01-07 17:59:49,826 - INFO - Total tests: 12
2026-01-07 17:59:49,826 - INFO - Tests to run: 12 (skipping 0 completed)
2026-01-07 17:59:49,826 - INFO - Estimated time: 120 - 180 minutes
2026-01-07 17:59:49,826 - INFO - [1/12] Running SimpleCNN/SimpleCNN...
2026-01-07 17:59:49,827 - INFO - Updated config: RGB=SimpleCNN, MAP=SimpleCNN, modalities=depth_rgb+thermal_map
2026-01-07 17:59:49,827 - INFO - ================================================================================
2026-01-07 17:59:49,827 - INFO - TEST 1/12: RGB=SimpleCNN, MAP=SimpleCNN
2026-01-07 17:59:49,827 - INFO - ================================================================================
2026-01-07 19:37:25,020 - INFO - âœ“ Result: Kappa=0.2337, Time=97.6 min
2026-01-07 19:37:25,042 - INFO - [2/12] Running SimpleCNN/EfficientNetB0...
2026-01-07 19:37:25,045 - INFO - Updated config: RGB=SimpleCNN, MAP=EfficientNetB0, modalities=depth_rgb+thermal_map
2026-01-07 19:37:25,046 - INFO - ================================================================================
2026-01-07 19:37:25,046 - INFO - TEST 2/12: RGB=SimpleCNN, MAP=EfficientNetB0
2026-01-07 19:37:25,046 - INFO - ================================================================================
2026-01-08 00:07:21,677 - INFO - Loaded 1 previous test results
2026-01-08 00:07:21,687 - INFO - âœ“ Result: Kappa=0.1648, Time=269.9 min
2026-01-08 00:07:21,694 - INFO - [3/12] Running SimpleCNN/EfficientNetB1...
2026-01-08 00:07:21,696 - INFO - Updated config: RGB=SimpleCNN, MAP=EfficientNetB1, modalities=depth_rgb+thermal_map
2026-01-08 00:07:21,696 - INFO - ================================================================================
2026-01-08 00:07:21,696 - INFO - TEST 3/12: RGB=SimpleCNN, MAP=EfficientNetB1
2026-01-08 00:07:21,696 - INFO - ================================================================================
2026-01-08 05:59:50,933 - INFO - Loaded 2 previous test results
2026-01-08 05:59:50,943 - INFO - âœ“ Result: Kappa=0.1807, Time=352.5 min
2026-01-08 05:59:50,950 - INFO - [4/12] Running EfficientNetB0/SimpleCNN...
2026-01-08 05:59:50,952 - INFO - Updated config: RGB=EfficientNetB0, MAP=SimpleCNN, modalities=depth_rgb+thermal_map
2026-01-08 05:59:50,952 - INFO - ================================================================================
2026-01-08 05:59:50,952 - INFO - TEST 4/12: RGB=EfficientNetB0, MAP=SimpleCNN
2026-01-08 05:59:50,952 - INFO - ================================================================================
g default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 100.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 2 files deleted
  Predictions: 8 files deleted
  Csv Results: 5 files deleted
  Tf Cache: 4 files deleted
================================================================================

I0000 00:00:1767826801.947889  499123 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767826801.983195  499123 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Using existing cleaned dataset for depth_rgb_thermal_map: depth_rgb_thermal_map_15pct.csv
Applying cleaned dataset for depth_rgb_thermal_map (15% outlier removal)...
  Filtered: 2852 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_rgb_thermal_map: 2499 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2852
  depth_bb: 2852
  thermal_map: 2852
  thermal_bb: 2852
Using 100.0% of the data: 2852 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/3: 144 train patients, 73 valid patients
  Train dist: {0: 0.295, 1: 0.593, 2: 0.112}
  Valid dist: {0: 0.268, 1: 0.635, 2: 0.097}
Fold 2/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.290, 1: 0.611, 2: 0.098}
  Valid dist: {0: 0.275, 1: 0.601, 2: 0.124}
Fold 3/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.271, 1: 0.619, 2: 0.110}
  Valid dist: {0: 0.317, 1: 0.584, 2: 0.100}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767826809.549349  499123 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/3 with all modalities: ['thermal_map', 'depth_rgb']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/3
No existing pretrained weights found
I0000 00:00:1767827000.803097  499352 cuda_dnn.cc:529] Loaded cuDNN version 91002
Epoch 32: early stopping
Restoring model weights from the end of the best epoch: 12.

Run 1 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.35      0.49      0.41       274
           P       0.69      0.57      0.62       650
           R       0.34      0.37      0.35        99

    accuracy                           0.53      1023
   macro avg       0.46      0.48      0.46      1023
weighted avg       0.56      0.53      0.54      1023

Cohen's Kappa: 0.2337

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.5279
F1 Macro: 0.4623
Kappa: 0.2337

Fold 2/3
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 2/3 with all modalities: ['thermal_map', 'depth_rgb']
Using consistent patient split across all modality combinations for run 2

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 2/3
No existing pretrained weights found
Epoch 79: early stopping
Restoring model weights from the end of the best epoch: 59.

Run 2 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.35      0.59      0.44       263
           P       0.67      0.29      0.41       574
           R       0.29      0.64      0.40       118

    accuracy                           0.42       955
   macro avg       0.44      0.51      0.42       955
weighted avg       0.53      0.42      0.42       955

Cohen's Kappa: 0.2693

Training gating network for run 2...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 2:
Accuracy: 0.4188
F1 Macro: 0.4170
Kappa: 0.2693

Fold 3/3
Using pre-computed fold 3 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 3/3 with all modalities: ['thermal_map', 'depth_rgb']
Using consistent patient split across all modality combinations for run 3

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 3/3
No existing pretrained weights found
Epoch 22: early stopping
Restoring model weights from the end of the best epoch: 2.

Run 3 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.40      0.45      0.42       277
           P       0.63      0.52      0.57       510
           R       0.17      0.28      0.21        87

    accuracy                           0.47       874
   macro avg       0.40      0.42      0.40       874
weighted avg       0.51      0.47      0.49       874

Cohen's Kappa: 0.1466

Training gating network for run 3...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 3:
Accuracy: 0.4725
F1 Macro: 0.4013
Kappa: 0.1466
Results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_results_averaged.csv
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_valid.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_valid.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run3_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run3_valid.npy
Results for depth_rgb, thermal_map appended to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

All results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

================================================================================
FINAL SUMMARY - BEST MODALITY COMBINATIONS
================================================================================

Best by Accuracy:
  Modalities: depth_rgb+thermal_map
  Accuracy: 0.4731 Â± 0.0445
  F1 Macro: 0.4269
  Kappa: 0.2166

Total combinations tested: 1
================================================================================

I0000 00:00:1767832633.045212  499123 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767832633.057967  499123 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1
================================================================================


================================================================================
SUBPROCESS OUTPUT - TEST 2: RGB=SimpleCNN, MAP=EfficientNetB0
================================================================================
2026-01-07 19:37:27.033638: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1767832647.115970  580341 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767832647.140273  580341 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
/home/rezab/projects/enviroments/multimodal/lib/python3.12/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA TITAN Xp - 12.0GB (compute 6.1)
  GPU 1: Quadro P400 - 2.0GB (compute 6.1)
  GPU 1 (Quadro P400, 2.0GB): Excluded (< 8.0GB)

Selected GPU 0: NVIDIA TITAN Xp (12.0GB)
I0000 00:00:1767832667.692158  580341 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 100.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 3 files deleted
  Predictions: 36 files deleted
  Csv Results: 15 files deleted
  Tf Cache: 4 files deleted
================================================================================

I0000 00:00:1767832669.367062  580341 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767832669.401423  580341 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Using existing cleaned dataset for depth_rgb_thermal_map: depth_rgb_thermal_map_15pct.csv
Applying cleaned dataset for depth_rgb_thermal_map (15% outlier removal)...
  Filtered: 2852 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_rgb_thermal_map: 2499 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2852
  depth_bb: 2852
  thermal_map: 2852
  thermal_bb: 2852
Using 100.0% of the data: 2852 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/3: 144 train patients, 73 valid patients
  Train dist: {0: 0.295, 1: 0.593, 2: 0.112}
  Valid dist: {0: 0.268, 1: 0.635, 2: 0.097}
Fold 2/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.290, 1: 0.611, 2: 0.098}
  Valid dist: {0: 0.275, 1: 0.601, 2: 0.124}
Fold 3/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.271, 1: 0.619, 2: 0.110}
  Valid dist: {0: 0.317, 1: 0.584, 2: 0.100}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767832677.129482  580341 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/3
No existing pretrained weights found
I0000 00:00:1767832914.961119  580594 cuda_dnn.cc:529] Loaded cuDNN version 91002
Epoch 39: early stopping
Restoring model weights from the end of the best epoch: 19.

Run 1 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.32      0.72      0.45       274
           P       0.78      0.12      0.21       650
           R       0.17      0.53      0.26        99

    accuracy                           0.32      1023
   macro avg       0.42      0.46      0.30      1023
weighted avg       0.60      0.32      0.28      1023

Cohen's Kappa: 0.1648

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.3226
F1 Macro: 0.3050
Kappa: 0.1648

Fold 2/3
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 2/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 2

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 2/3
No existing pretrained weights found
Epoch 53: early stopping
Restoring model weights from the end of the best epoch: 33.

Run 2 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.33      0.59      0.42       263
           P       0.62      0.25      0.36       574
           R       0.25      0.55      0.35       118

    accuracy                           0.38       955
   macro avg       0.40      0.46      0.38       955
weighted avg       0.50      0.38      0.38       955

Cohen's Kappa: 0.2210

Training gating network for run 2...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 2:
Accuracy: 0.3812
F1 Macro: 0.3763
Kappa: 0.2210

Fold 3/3
Using pre-computed fold 3 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 3/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 3

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 3/3
No existing pretrained weights found
Epoch 22: early stopping
Restoring model weights from the end of the best epoch: 2.

Run 3 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.36      0.50      0.42       277
           P       0.61      0.55      0.58       510
           R       0.13      0.06      0.08        87

    accuracy                           0.48       874
   macro avg       0.37      0.37      0.36       874
weighted avg       0.49      0.48      0.48       874

Cohen's Kappa: 0.0795

Training gating network for run 3...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 3:
Accuracy: 0.4828
F1 Macro: 0.3595
Kappa: 0.0795
Results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_results_averaged.csv
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_valid.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_valid.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run3_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run3_valid.npy
Results for depth_rgb, thermal_map appended to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

All results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

================================================================================
FINAL SUMMARY - BEST MODALITY COMBINATIONS
================================================================================

Best by Accuracy:
  Modalities: depth_rgb+thermal_map
  Accuracy: 0.3955 Â± 0.0662
  F1 Macro: 0.3469
  Kappa: 0.1551

Total combinations tested: 1
================================================================================

I0000 00:00:1767848821.008407  580341 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767848821.022266  580341 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1
================================================================================


================================================================================
SUBPROCESS OUTPUT - TEST 3: RGB=SimpleCNN, MAP=EfficientNetB1
================================================================================
2026-01-08 00:07:23.690390: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1767848843.783293  690087 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767848843.811406  690087 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
/home/rezab/projects/enviroments/multimodal/lib/python3.12/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA TITAN Xp - 12.0GB (compute 6.1)
  GPU 1: Quadro P400 - 2.0GB (compute 6.1)
  GPU 1 (Quadro P400, 2.0GB): Excluded (< 8.0GB)

Selected GPU 0: NVIDIA TITAN Xp (12.0GB)
I0000 00:00:1767848863.543289  690087 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 100.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 3 files deleted
  Predictions: 36 files deleted
  Csv Results: 15 files deleted
  Tf Cache: 4 files deleted
================================================================================

I0000 00:00:1767848865.278490  690087 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767848865.319917  690087 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Using existing cleaned dataset for depth_rgb_thermal_map: depth_rgb_thermal_map_15pct.csv
Applying cleaned dataset for depth_rgb_thermal_map (15% outlier removal)...
  Filtered: 2852 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_rgb_thermal_map: 2499 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2852
  depth_bb: 2852
  thermal_map: 2852
  thermal_bb: 2852
Using 100.0% of the data: 2852 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/3: 144 train patients, 73 valid patients
  Train dist: {0: 0.295, 1: 0.593, 2: 0.112}
  Valid dist: {0: 0.268, 1: 0.635, 2: 0.097}
Fold 2/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.290, 1: 0.611, 2: 0.098}
  Valid dist: {0: 0.275, 1: 0.601, 2: 0.124}
Fold 3/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.271, 1: 0.619, 2: 0.110}
  Valid dist: {0: 0.317, 1: 0.584, 2: 0.100}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767848874.296677  690087 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/3
No existing pretrained weights found
I0000 00:00:1767849140.326635  690359 cuda_dnn.cc:529] Loaded cuDNN version 91002
Epoch 32: early stopping
Restoring model weights from the end of the best epoch: 12.

Run 1 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.38      0.45      0.41       274
           P       0.68      0.61      0.64       650
           R       0.19      0.21      0.20        99

    accuracy                           0.53      1023
   macro avg       0.41      0.42      0.42      1023
weighted avg       0.55      0.53      0.53      1023

Cohen's Kappa: 0.1807

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.5259
F1 Macro: 0.4150
Kappa: 0.1807

Fold 2/3
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 2/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 2

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 2/3
No existing pretrained weights found
Epoch 22: early stopping
Restoring model weights from the end of the best epoch: 2.

Run 2 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.30      0.41      0.35       263
           P       0.64      0.27      0.38       574
           R       0.15      0.44      0.22       118

    accuracy                           0.33       955
   macro avg       0.36      0.38      0.32       955
weighted avg       0.49      0.33      0.35       955

Cohen's Kappa: 0.0486

Training gating network for run 2...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 2:
Accuracy: 0.3319
F1 Macro: 0.3176
Kappa: 0.0486

Fold 3/3
Using pre-computed fold 3 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 3/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 3

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 3/3
No existing pretrained weights found
Epoch 52: early stopping
Restoring model weights from the end of the best epoch: 32.

Run 3 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.41      0.44      0.42       277
           P       0.61      0.44      0.51       510
           R       0.17      0.41      0.24        87

    accuracy                           0.44       874
   macro avg       0.40      0.43      0.39       874
weighted avg       0.50      0.44      0.46       874

Cohen's Kappa: 0.1787

Training gating network for run 3...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 3:
Accuracy: 0.4371
F1 Macro: 0.3928
Kappa: 0.1787
Results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_results_averaged.csv
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_valid.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_valid.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run3_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run3_valid.npy
Results for depth_rgb, thermal_map appended to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

All results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

================================================================================
FINAL SUMMARY - BEST MODALITY COMBINATIONS
================================================================================

Best by Accuracy:
  Modalities: depth_rgb+thermal_map
  Accuracy: 0.4316 Â± 0.0793
  F1 Macro: 0.3751
  Kappa: 0.1360

Total combinations tested: 1
================================================================================

I0000 00:00:1767869957.337133  690087 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767869957.354838  690087 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1
================================================================================


================================================================================
SUBPROCESS OUTPUT - TEST 4: RGB=EfficientNetB0, MAP=SimpleCNN
================================================================================
2026-01-08 05:59:53.985436: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1767869994.065992  813364 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767869994.092525  813364 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
/home/rezab/projects/enviroments/multimodal/lib/python3.12/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA TITAN Xp - 12.0GB (compute 6.1)
  GPU 1: Quadro P400 - 2.0GB (compute 6.1)
  GPU 1 (Quadro P400, 2.0GB): Excluded (< 8.0GB)

Selected GPU 0: NVIDIA TITAN Xp (12.0GB)
I0000 00:00:1767870017.314418  813364 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 100.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 3 files deleted
  Predictions: 36 files deleted
  Csv Results: 15 files deleted
  Tf Cache: 4 files deleted
================================================================================

I0000 00:00:1767870019.075218  813364 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767870019.166709  813364 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Using existing cleaned dataset for depth_rgb_thermal_map: depth_rgb_thermal_map_15pct.csv
Applying cleaned dataset for depth_rgb_thermal_map (15% outlier removal)...
  Filtered: 2852 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_rgb_thermal_map: 2499 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2852
  depth_bb: 2852
  thermal_map: 2852
  thermal_bb: 2852
Using 100.0% of the data: 2852 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/3: 144 train patients, 73 valid patients
  Train dist: {0: 0.295, 1: 0.593, 2: 0.112}
  Valid dist: {0: 0.268, 1: 0.635, 2: 0.097}
Fold 2/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.290, 1: 0.611, 2: 0.098}
  Valid dist: {0: 0.275, 1: 0.601, 2: 0.124}
Fold 3/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.271, 1: 0.619, 2: 0.110}
  Valid dist: {0: 0.317, 1: 0.584, 2: 0.100}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767870026.786340  813364 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/3
No existing pretrained weights found
I0000 00:00:1767870294.994267  813628 cuda_dnn.cc:529] Loaded cuDNN version 91002
Epoch 23: early stopping
Restoring model weights from the end of the best epoch: 3.

Run 1 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.30      0.35      0.33       274
           P       0.65      0.63      0.64       650
           R       0.39      0.29      0.34        99

    accuracy                           0.52      1023
   macro avg       0.45      0.43      0.43      1023
weighted avg       0.53      0.52      0.53      1023

Cohen's Kappa: 0.1638

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.5239
F1 Macro: 0.4343
Kappa: 0.1638

Fold 2/3
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 2/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 2

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 2/3
No existing pretrained weights found
