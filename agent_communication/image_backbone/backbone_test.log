2026-01-07 17:59:49,825 - INFO - ================================================================================
2026-01-07 17:59:49,825 - INFO - AUTOMATED BACKBONE COMPARISON
2026-01-07 17:59:49,825 - INFO - ================================================================================
2026-01-07 17:59:49,825 - INFO - Log file: /home/rezab/projects/DFUMultiClassification/agent_communication/image_backbone/backbone_test.log
2026-01-07 17:59:49,825 - INFO - Starting FRESH run (previous results will be overwritten)
2026-01-07 17:59:49,825 - INFO - Saved original INCLUDED_COMBINATIONS
2026-01-07 17:59:49,826 - INFO - Configuration:
2026-01-07 17:59:49,826 - INFO -   RGB Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1', 'EfficientNetB3']
2026-01-07 17:59:49,826 - INFO -   MAP Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1']
2026-01-07 17:59:49,826 - INFO -   Data: 100%
2026-01-07 17:59:49,826 - INFO -   Image Size: 64x64
2026-01-07 17:59:49,826 - INFO -   Device: single
2026-01-07 17:59:49,826 - INFO -   Test modalities: depth_rgb + thermal_map
2026-01-07 17:59:49,826 - INFO - Total tests: 12
2026-01-07 17:59:49,826 - INFO - Tests to run: 12 (skipping 0 completed)
2026-01-07 17:59:49,826 - INFO - Estimated time: 120 - 180 minutes
2026-01-07 17:59:49,826 - INFO - [1/12] Running SimpleCNN/SimpleCNN...
2026-01-07 17:59:49,827 - INFO - Updated config: RGB=SimpleCNN, MAP=SimpleCNN, modalities=depth_rgb+thermal_map
2026-01-07 17:59:49,827 - INFO - ================================================================================
2026-01-07 17:59:49,827 - INFO - TEST 1/12: RGB=SimpleCNN, MAP=SimpleCNN
2026-01-07 17:59:49,827 - INFO - ================================================================================

================================================================================
SUBPROCESS OUTPUT - TEST 1: RGB=SimpleCNN, MAP=SimpleCNN
================================================================================
2026-01-07 17:59:50.581809: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1767826790.605321  499123 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767826790.612618  499123 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
/home/rezab/projects/enviroments/multimodal/lib/python3.12/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA TITAN Xp - 12.0GB (compute 6.1)
  GPU 1: Quadro P400 - 2.0GB (compute 6.1)
  GPU 1 (Quadro P400, 2.0GB): Excluded (< 8.0GB)

Selected GPU 0: NVIDIA TITAN Xp (12.0GB)
I0000 00:00:1767826800.514520  499123 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 100.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 2 files deleted
  Predictions: 8 files deleted
  Csv Results: 5 files deleted
  Tf Cache: 4 files deleted
================================================================================

I0000 00:00:1767826801.947889  499123 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767826801.983195  499123 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Using existing cleaned dataset for depth_rgb_thermal_map: depth_rgb_thermal_map_15pct.csv
Applying cleaned dataset for depth_rgb_thermal_map (15% outlier removal)...
  Filtered: 2852 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_rgb_thermal_map: 2499 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2852
  depth_bb: 2852
  thermal_map: 2852
  thermal_bb: 2852
Using 100.0% of the data: 2852 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/3: 144 train patients, 73 valid patients
  Train dist: {0: 0.295, 1: 0.593, 2: 0.112}
  Valid dist: {0: 0.268, 1: 0.635, 2: 0.097}
Fold 2/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.290, 1: 0.611, 2: 0.098}
  Valid dist: {0: 0.275, 1: 0.601, 2: 0.124}
Fold 3/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.271, 1: 0.619, 2: 0.110}
  Valid dist: {0: 0.317, 1: 0.584, 2: 0.100}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767826809.549349  499123 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/3 with all modalities: ['thermal_map', 'depth_rgb']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/3
No existing pretrained weights found
I0000 00:00:1767827000.803097  499352 cuda_dnn.cc:529] Loaded cuDNN version 91002
