2026-01-07 17:02:47,461 - INFO - ================================================================================
2026-01-07 17:02:47,462 - INFO - AUTOMATED BACKBONE COMPARISON
2026-01-07 17:02:47,462 - INFO - ================================================================================
2026-01-07 17:02:47,462 - INFO - Log file: /home/rezab/projects/DFUMultiClassification/agent_communication/image_backbone/backbone_test.log
2026-01-07 17:02:47,462 - INFO - Starting FRESH run (previous results will be overwritten)
2026-01-07 17:02:47,462 - INFO - Saved original INCLUDED_COMBINATIONS
2026-01-07 17:02:47,462 - INFO - Configuration:
2026-01-07 17:02:47,462 - INFO -   RGB Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1', 'EfficientNetB3']
2026-01-07 17:02:47,463 - INFO -   MAP Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1']
2026-01-07 17:02:47,463 - INFO -   Data: 20%
2026-01-07 17:02:47,463 - INFO -   Image Size: 12x12
2026-01-07 17:02:47,463 - INFO -   Device: single
2026-01-07 17:02:47,463 - INFO -   Test modalities: depth_rgb + thermal_map
2026-01-07 17:02:47,463 - INFO - Total tests: 12
2026-01-07 17:02:47,463 - INFO - Tests to run: 12 (skipping 0 completed)
2026-01-07 17:02:47,463 - INFO - Estimated time: 120 - 180 minutes
2026-01-07 17:02:47,463 - INFO - [1/12] Running SimpleCNN/SimpleCNN...
2026-01-07 17:02:47,464 - INFO - Updated config: RGB=SimpleCNN, MAP=SimpleCNN, modalities=depth_rgb+thermal_map
2026-01-07 17:02:47,464 - INFO - ================================================================================
2026-01-07 17:02:47,464 - INFO - TEST 1/12: RGB=SimpleCNN, MAP=SimpleCNN
2026-01-07 17:02:47,464 - INFO - ================================================================================
2026-01-07 17:20:31,432 - INFO - âœ“ Result: Kappa=0.0343, Time=17.7 min
2026-01-07 17:20:31,433 - INFO - [2/12] Running SimpleCNN/EfficientNetB0...
2026-01-07 17:20:31,434 - INFO - Updated config: RGB=SimpleCNN, MAP=EfficientNetB0, modalities=depth_rgb+thermal_map
2026-01-07 17:20:31,434 - INFO - ================================================================================
2026-01-07 17:20:31,434 - INFO - TEST 2/12: RGB=SimpleCNN, MAP=EfficientNetB0
2026-01-07 17:20:31,434 - INFO - ================================================================================
 Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767823368.635778  464641 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
/home/rezab/projects/enviroments/multimodal/lib/python3.12/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA TITAN Xp - 12.0GB (compute 6.1)
  GPU 1: Quadro P400 - 2.0GB (compute 6.1)
  GPU 1 (Quadro P400, 2.0GB): Excluded (< 8.0GB)

Selected GPU 0: NVIDIA TITAN Xp (12.0GB)
I0000 00:00:1767823378.291686  464641 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 20.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 2-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 1 files deleted
  Csv Results: 1 files deleted
  Tf Cache: 2 files deleted
================================================================================

I0000 00:00:1767823379.808775  464641 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767823379.845199  464641 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Using existing cleaned dataset for depth_rgb_thermal_map: depth_rgb_thermal_map_15pct.csv
Applying cleaned dataset for depth_rgb_thermal_map (15% outlier removal)...
  Filtered: 2852 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_rgb_thermal_map: 2499 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 2-fold CV
Iterations per combination: 2
Total training sessions: 2
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2852
  depth_bb: 2852
  thermal_map: 2852
  thermal_bb: 2852
Using 20.0% of the data: 570 samples

================================================================================
GENERATING 2-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/2: 86 train patients, 88 valid patients
  Train dist: {0: 0.261, 1: 0.638, 2: 0.101}
  Valid dist: {0: 0.296, 1: 0.609, 2: 0.095}
Fold 2/2: 88 train patients, 86 valid patients
  Train dist: {0: 0.296, 1: 0.609, 2: 0.095}
  Valid dist: {0: 0.261, 1: 0.638, 2: 0.101}
Generated 2 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/2
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767823386.152106  464641 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/2 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/2
No existing pretrained weights found
I0000 00:00:1767823430.630051  464866 cuda_dnn.cc:529] Loaded cuDNN version 91002
Epoch 25: early stopping
Restoring model weights from the end of the best epoch: 5.

Run 1 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.27      0.44      0.33        87
           P       0.60      0.51      0.55       179
           R       1.00      0.04      0.07        28

    accuracy                           0.44       294
   macro avg       0.62      0.33      0.32       294
weighted avg       0.54      0.44      0.44       294

Cohen's Kappa: -0.0526

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.4422
F1 Macro: 0.3175
Kappa: -0.0526

Fold 2/2
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier

Preparing datasets for Fold 2/2 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 2

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 2/2
No existing pretrained weights found
Epoch 30: early stopping
Restoring model weights from the end of the best epoch: 10.

Run 2 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.30      0.38      0.33        72
           P       0.68      0.62      0.65       176
           R       0.17      0.14      0.15        28

    accuracy                           0.51       276
   macro avg       0.38      0.38      0.38       276
weighted avg       0.53      0.51      0.51       276

Cohen's Kappa: 0.0343

Training gating network for run 2...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 2:
Accuracy: 0.5072
F1 Macro: 0.3773
Kappa: 0.0343
Results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_results_averaged.csv
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run1_valid.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_train.npy
Saved depth_rgb+thermal_map predictions to /home/rezab/projects/DFUMultiClassification/results/checkpoints/combo_pred_depth_rgb_thermal_map_run2_valid.npy
Results for depth_rgb, thermal_map appended to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

All results saved to /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv

================================================================================
FINAL SUMMARY - BEST MODALITY COMBINATIONS
================================================================================

Best by Accuracy:
  Modalities: depth_rgb+thermal_map
  Accuracy: 0.4747 Â± 0.0325
  F1 Macro: 0.3474
  Kappa: -0.0092

Total combinations tested: 1
================================================================================

I0000 00:00:1767824425.388138  464641 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767824425.388740  464641 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1
================================================================================


================================================================================
SUBPROCESS OUTPUT - TEST 2: RGB=SimpleCNN, MAP=EfficientNetB0
================================================================================
2026-01-07 17:20:32.273853: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1767824432.298744  478571 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767824432.305933  478571 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
/home/rezab/projects/enviroments/multimodal/lib/python3.12/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA TITAN Xp - 12.0GB (compute 6.1)
  GPU 1: Quadro P400 - 2.0GB (compute 6.1)
  GPU 1 (Quadro P400, 2.0GB): Excluded (< 8.0GB)

Selected GPU 0: NVIDIA TITAN Xp (12.0GB)
I0000 00:00:1767824441.846840  478571 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 20.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 2-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Models: 2 files deleted
  Predictions: 24 files deleted
  Csv Results: 11 files deleted
  Tf Cache: 2 files deleted
================================================================================

I0000 00:00:1767824443.309894  478571 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767824443.338687  478571 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Using existing cleaned dataset for depth_rgb_thermal_map: depth_rgb_thermal_map_15pct.csv
Applying cleaned dataset for depth_rgb_thermal_map (15% outlier removal)...
  Filtered: 2852 samples
  Applied cleaned dataset to: best_matching.csv
  âœ“ Applied for depth_rgb_thermal_map: 2499 samples

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 2-fold CV
Iterations per combination: 2
Total training sessions: 2
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2852
  depth_bb: 2852
  thermal_map: 2852
  thermal_bb: 2852
Using 20.0% of the data: 570 samples

================================================================================
GENERATING 2-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/2: 86 train patients, 88 valid patients
  Train dist: {0: 0.261, 1: 0.638, 2: 0.101}
  Valid dist: {0: 0.296, 1: 0.609, 2: 0.095}
Fold 2/2: 88 train patients, 86 valid patients
  Train dist: {0: 0.296, 1: 0.609, 2: 0.095}
  Valid dist: {0: 0.261, 1: 0.638, 2: 0.101}
Generated 2 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/2
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767824448.575359  478571 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/2 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/2
No existing pretrained weights found
I0000 00:00:1767824537.872605  478790 cuda_dnn.cc:529] Loaded cuDNN version 91002
