2026-01-07 05:44:44,091 - INFO - ================================================================================
2026-01-07 05:44:44,091 - INFO - AUTOMATED BACKBONE COMPARISON
2026-01-07 05:44:44,092 - INFO - ================================================================================
2026-01-07 05:44:44,092 - INFO - Log file: /home/rezab/projects/DFUMultiClassification/agent_communication/image_backbone/backbone_test.log
2026-01-07 05:44:44,092 - INFO - Saved original INCLUDED_COMBINATIONS
2026-01-07 05:44:44,092 - INFO - Configuration:
2026-01-07 05:44:44,093 - INFO -   RGB Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1', 'EfficientNetB3']
2026-01-07 05:44:44,093 - INFO -   MAP Backbones: ['SimpleCNN', 'EfficientNetB0', 'EfficientNetB1']
2026-01-07 05:44:44,093 - INFO -   Data: 50%
2026-01-07 05:44:44,093 - INFO -   Image Size: 32x32
2026-01-07 05:44:44,093 - INFO -   Device: single
2026-01-07 05:44:44,093 - INFO -   Test modalities: depth_rgb + thermal_map
2026-01-07 05:44:44,093 - INFO - Total tests to run: 12
2026-01-07 05:44:44,093 - INFO - Estimated time: 120 - 180 minutes
2026-01-07 05:44:44,094 - INFO - Updated config: RGB=SimpleCNN, MAP=SimpleCNN, modalities=depth_rgb+thermal_map
2026-01-07 05:44:44,094 - INFO - ================================================================================
2026-01-07 05:44:44,094 - INFO - TEST 1/12: RGB=SimpleCNN, MAP=SimpleCNN
2026-01-07 05:44:44,094 - INFO - ================================================================================

================================================================================
SUBPROCESS OUTPUT - TEST 1: RGB=SimpleCNN, MAP=SimpleCNN
================================================================================
2026-01-07 05:44:44.909870: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1767782684.938382  116041 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767782684.945256  116041 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
/home/rezab/projects/enviroments/multimodal/lib/python3.12/site-packages/keras/src/export/tf2onnx_lib.py:8: FutureWarning: In the future `np.object` will be defined as the corresponding NumPy scalar.
  if not hasattr(np, "object"):

================================================================================
DEVICE CONFIGURATION (mode: single)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA TITAN Xp - 12.0GB (compute 6.1)
  GPU 1: Quadro P400 - 2.0GB (compute 6.1)
  GPU 1 (Quadro P400, 2.0GB): Excluded (< 8.0GB)

Selected GPU 0: NVIDIA TITAN Xp (12.0GB)
I0000 00:00:1767782693.954951  116041 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
Enabled memory growth for 1 GPU(s)

Using default strategy (single GPU)
================================================================================


Batch size per replica: 4 (global batch size: 4, replicas: 1)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 50.0%
Verbosity: 1 (NORMAL)
Device: GPU 0 (single GPU mode)
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 32x32
Batch size: 4
Max epochs: 300 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Csv Results: 1 files deleted
  Tf Cache: 2 files deleted
================================================================================

I0000 00:00:1767782695.456414  116041 gpu_device.cc:2413] Ignoring visible gpu device (device: 1, name: Quadro P400, pci bus id: 0000:65:00.0, compute capability: 6.1) with core count: 2. The minimum required count is 8. You can adjust this requirement with the env var TF_MIN_GPU_MULTIPROCESSOR_COUNT.
I0000 00:00:1767782695.484540  116041 gpu_device.cc:2022] Created device /device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Data Cleaning Configuration (from production_config.py):
  Outlier removal: True
  Outlier contamination: 15%
  Outlier batch size: 32
  Misclassification tracking: none

================================================================================
OUTLIER DETECTION AND REMOVAL (COMBINATION-SPECIFIC)
================================================================================
Contamination rate: 15%
Processing 1 modality combination(s)

[1/1] depth_rgb_thermal_map
Detecting outliers for combination: depth_rgb_thermal_map (contamination=15%)...
  Error: Feature count mismatch for depth_rgb: 3107 vs 2941
  âš  Detection failed for depth_rgb_thermal_map, using original

================================================================================


================================================================================
MODALITY SEARCH MODE: CUSTOM (1 combinations)
================================================================================
Testing only specified combinations from production_config.py
Total combinations to test: 1
Cross-validation mode: 3-fold CV
Iterations per combination: 3
Total training sessions: 3
Results will be saved to: /home/rezab/projects/DFUMultiClassification/results/csv/modality_combination_results.csv
================================================================================


Testing modalities: depth_rgb, thermal_map
Number of samples for each selected modality:
  depth_rgb: 2941
  depth_bb: 2941
  thermal_map: 2941
  thermal_bb: 2941
Using 50.0% of the data: 1470 samples

================================================================================
GENERATING 3-FOLD CROSS-VALIDATION SPLITS (PATIENT-LEVEL)
================================================================================
Fold 1/3: 143 train patients, 74 valid patients
  Train dist: {0: 0.319, 1: 0.568, 2: 0.113}
  Valid dist: {0: 0.244, 1: 0.638, 2: 0.117}
Fold 2/3: 145 train patients, 72 valid patients
  Train dist: {0: 0.267, 1: 0.613, 2: 0.120}
  Valid dist: {0: 0.340, 1: 0.557, 2: 0.103}
Fold 3/3: 146 train patients, 71 valid patients
  Train dist: {0: 0.292, 1: 0.598, 2: 0.110}
  Valid dist: {0: 0.294, 1: 0.582, 2: 0.124}
Generated 3 folds
All data will be validated exactly once across all folds
================================================================================


Fold 1/3
Using pre-computed fold 1 patient split
Using Scikit-learn RandomForestClassifier
I0000 00:00:1767782702.200592  116041 gpu_device.cc:2022] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 10709 MB memory:  -> device: 0, name: NVIDIA TITAN Xp, pci bus id: 0000:17:00.0, compute capability: 6.1

Preparing datasets for Fold 1/3 with all modalities: ['depth_rgb', 'thermal_map']
Using consistent patient split across all modality combinations for run 1

No existing data found for depth_rgb+thermal_map, starting fresh

Training depth_rgb+thermal_map with modalities: ['depth_rgb', 'thermal_map'], fold 1/3
No existing pretrained weights found
I0000 00:00:1767782776.887333  116264 cuda_dnn.cc:529] Loaded cuDNN version 91002
Epoch 23: early stopping
Restoring model weights from the end of the best epoch: 3.

Run 1 Results for depth_rgb+thermal_map:
              precision    recall  f1-score   support

           I       0.31      0.28      0.30       127
           P       0.65      0.69      0.67       332
           R       0.18      0.15      0.16        61

    accuracy                           0.53       520
   macro avg       0.38      0.37      0.38       520
weighted avg       0.51      0.53      0.52       520

Cohen's Kappa: 0.1035

Training gating network for run 1...

Initializing gating network training...
Skipping gating network: only 1 model(s), need at least 2 to combine

Gating Network Results for Run 1:
Accuracy: 0.5269
F1 Macro: 0.3753
Kappa: 0.1035

Fold 2/3
Using pre-computed fold 2 patient split
Using Scikit-learn RandomForestClassifier
