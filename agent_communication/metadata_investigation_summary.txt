================================================================================
METADATA PERFORMANCE INVESTIGATION SUMMARY
================================================================================

Investigation Date: 2025-12-24
Investigator: Claude Code

================================================================================
PROBLEM STATEMENT
================================================================================

Phase 9 debug script achieved:
  - Accuracy: 97.59%
  - F1 Macro: 0.9720
  - Min F1: 0.9640

CV Test achieved:
  - Accuracy: 50.14%
  - F1 Macro: 0.3674
  - Min F1: 0.1261

Performance drop: 47.45 percentage points

================================================================================
ROOT CAUSE ANALYSIS
================================================================================

PRIMARY CAUSE: Model Architecture Mismatch
------------------------------------------

Phase 9 uses a DEDICATED metadata model:
  Dense(128, relu) -> Dropout(0.3) -> Dense(64, relu) -> Dropout(0.3) -> Dense(3, softmax)

  Parameters: ~10,000+
  Capacity: High - can learn complex feature relationships

CV Test uses a MINIMAL metadata branch:
  Input -> BatchNormalization -> Dense(3, softmax)

  Parameters: ~48 (only final Dense layer)
  Capacity: Very Low - essentially linear classification

The CV test architecture was designed for multimodal fusion where metadata is
combined with image features. When used standalone, it lacks the representational
capacity to learn from metadata alone.

SECONDARY CAUSES:
-----------------

1. Different Loss Functions:
   - Phase 9: categorical_crossentropy (standard multi-class)
   - CV Test: focal_ordinal_loss (designed for imbalanced ordinal data)

2. Different Learning Rates:
   - Phase 9: 0.001
   - CV Test: 0.0001 (10x lower)

3. Different Training Setup:
   - Phase 9: RandomOverSampler for class balancing
   - CV Test: Class weights computed but applied differently

================================================================================
VERIFICATION EXPERIMENT
================================================================================

Created: agent_communication/test_metadata_phase9_style.py

This script tests metadata with Phase 9-style simple model architecture.

Results:
  - Test Accuracy: 98.87%
  - F1 per class [I, P, R]: [0.989, 0.991, 0.978]
  - Min F1: 0.978

Key finding: ALL classes are predicted well, not just majority class.
The high performance is NOT driven by majority class bias.

================================================================================
CONCLUSION
================================================================================

The metadata performance drop is NOT a bug or data leak.

It is an ARCHITECTURAL MISMATCH:
- The CV test multimodal architecture has a minimal metadata branch
- This branch is designed for fusion, not standalone metadata classification
- When metadata is the only modality, the model lacks capacity

RECOMMENDATION:
- For metadata-only classification, use Phase 9-style dedicated model
- For multimodal fusion, the current architecture may be appropriate
- Consider adding a configuration flag to use fuller metadata branch when needed

================================================================================
FILES CREATED DURING INVESTIGATION
================================================================================

1. agent_communication/verify_normalization.py
   - Verifies feature ranges before normalization
   - Confirms normalization happens in prepare_cached_datasets

2. agent_communication/test_metadata_phase9_style.py
   - Tests metadata with Phase 9 architecture
   - Proves simple model achieves high performance on all classes

================================================================================
