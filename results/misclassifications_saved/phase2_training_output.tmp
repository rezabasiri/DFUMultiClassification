2025-12-27 18:32:50.844057: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2025-12-27 18:32:50.844155: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2025-12-27 18:32:50.845963: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2025-12-27 18:32:51.574024: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT

================================================================================
DEVICE CONFIGURATION (mode: multi)
================================================================================

Detected 2 GPU(s):
  GPU 0: NVIDIA GeForce RTX 5090 - 31.8GB
  GPU 1: NVIDIA GeForce RTX 5090 - 31.8GB

Selected 2 GPU(s):
  GPU 0: NVIDIA GeForce RTX 5090 (31.8GB)
  GPU 1: NVIDIA GeForce RTX 5090 (31.8GB)
2025-12-27 18:32:56.075160: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.
2025-12-27 18:32:56.077594: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.
Enabled memory growth for 2 GPU(s)
2025-12-27 18:32:56.386654: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.
2025-12-27 18:32:56.388589: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.

Using MirroredStrategy (2 GPUs) with ReductionToOneDevice
  (GPU-based gradient aggregation, NCCL-free for RTX 5090 compatibility)
Effective batch size: 2Ã— global batch size
================================================================================


Batch size per replica: 50 (global batch size: 100, replicas: 2)

================================================================================
DFU MULTIMODAL CLASSIFICATION - PRODUCTION PIPELINE
================================================================================
Mode: search
Resume mode: fresh
Data percentage: 20.0%
Verbosity: 0 (MINIMAL)
Device: GPUs [0, 1] (multi-GPU mode, MirroredStrategy)
  Replicas: 2Ã— batch size distribution
Cross-validation: 3-fold CV (patient-level)

Configuration loaded from: src/utils/production_config.py
Image size: 128x128
Batch size: 100
  Per-GPU batch: 50 (100 / 2 GPUs)
Max epochs: 150 (with early stopping)
Modality search mode: custom
Will test 1 custom combinations
================================================================================


ðŸ§¹ FRESH START MODE: Deleting all checkpoints...
================================================================================

Cleanup Statistics:
  Csv Results: 15 files deleted
  Tf Cache: 4 files deleted
================================================================================

2025-12-27 18:32:57.076040: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.
2025-12-27 18:32:57.077631: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.
Misclassification filtering thresholds: {'I': 22, 'P': 13, 'R': 22}

============================================================
FILTERING SUMMARY
============================================================
Thresholds: I=22, P=13, R=22

Excluded samples per class:
  Class I: 0 samples
  Class P: 260 samples
  Class R: 0 samples

Total unique samples to exclude: 260

Dataset size (rows): 3107 -> 1676 (53.9%)
Unique samples: 647 -> 387 (removed 260)

Class distribution after filtering:
  Class I: 892 rows
  Class P: 449 rows
  Class R: 335 rows
============================================================

2025-12-27 18:33:00.195719: W tensorflow/core/kernels/data/cache_dataset_ops.cc:302] The calling iterator did not fully read the dataset being cached. In order to avoid unexpected truncation of the dataset, the partially cached contents of the dataset  will be discarded. This can happen if you have an input pipeline similar to `dataset.cache().take(k).repeat()`. You should use `dataset.take(k).cache().repeat()` instead.
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1766860387.704317 2840046 device_compiler.h:186] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
2025-12-27 18:33:08.526436: W tensorflow/core/kernels/data/cache_dataset_ops.cc:302] The calling iterator did not fully read the dataset being cached. In order to avoid unexpected truncation of the dataset, the partially cached contents of the dataset  will be discarded. This can happen if you have an input pipeline similar to `dataset.cache().take(k).repeat()`. You should use `dataset.take(k).cache().repeat()` instead.
Restoring model weights from the end of the best epoch: 10.
Epoch 30: early stopping

Run 1 Results for metadata:
              precision    recall  f1-score   support

           I       0.43      0.25      0.31        61
           P       0.28      0.53      0.37        32
           R       0.39      0.33      0.36        21

    accuracy                           0.34       114
   macro avg       0.37      0.37      0.35       114
weighted avg       0.38      0.34      0.34       114

Cohen's Kappa: 0.0006
Restoring model weights from the end of the best epoch: 1.
Epoch 21: early stopping

Run 2 Results for metadata:
              precision    recall  f1-score   support

           I       0.52      0.36      0.43        61
           P       0.30      0.56      0.39        32
           R       0.75      0.43      0.55        21

    accuracy                           0.43       114
   macro avg       0.52      0.45      0.45       114
weighted avg       0.50      0.43      0.44       114

Cohen's Kappa: 0.1996
Restoring model weights from the end of the best epoch: 1.
Epoch 21: early stopping

Run 3 Results for metadata:
              precision    recall  f1-score   support

           I       0.57      0.90      0.70        61
           P       0.33      0.09      0.15        32
           R       1.00      0.43      0.60        21

    accuracy                           0.59       114
   macro avg       0.64      0.47      0.48       114
weighted avg       0.58      0.59      0.53       114

Cohen's Kappa: 0.3410

All results saved to /workspace/DFUMultiClassification/results/csv/modality_combination_results.csv

================================================================================
FINAL SUMMARY - BEST MODALITY COMBINATIONS
================================================================================

Best by Accuracy:
  Modalities: metadata
  Accuracy: 0.4532 Â± 0.1016
  F1 Macro: 0.4276
  Kappa: 0.1804

Total combinations tested: 1
================================================================================

2025-12-27 18:34:10.171877: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.
2025-12-27 18:34:10.173574: W tensorflow/core/common_runtime/gpu/gpu_device.cc:2348] TensorFlow was not built with CUDA kernel binaries compatible with compute capability 12.0. CUDA kernels will be jit-compiled from PTX, which could take 30 minutes or longer.
